extends "GradleJob.pkl"

import "@gha/catalog.pkl"

// Keep this in sync with projects that build java executables
local projects: List<String> = List("pkl-doc", "pkl-cli", "pkl-codegen-java", "pkl-codegen-kotlin")

local command =
  new Listing<String> {
    "./gradlew"
    module.gradleArgs
    for (project in projects) {
      // NOTE: `build` doesn't build native executables
      "\(project):build"
    }
  }.join(" ")

steps {
  catalog.`actions/checkout@v6`
  new {
    name = "gradle build java executables"
    shell = "bash"
    run = command
  }
  (catalog.`actions/upload-artifact@v5`) {
    name = "Upload executable artifacts"
    with {
      name = "executable-java"
      path = "*/build/executable/**/*"
    }
  }
}
